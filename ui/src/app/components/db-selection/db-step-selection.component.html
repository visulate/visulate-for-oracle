<div class="step-selection-container">
  <div class="step-selection-header">
    <span class="header-spacer"></span>
    @if (currentContext?.filter) {
    <app-filter-objects [currentEndpoint]="currentEndpoint"></app-filter-objects>
    }
  </div>
  @if (endpoints.errorMessage) {
  <div>
    <p class="warning">{{endpoints.errorMessage}}</p>
  </div>
  }
  <div class="step-selection-content">
    <mat-form-field>
      <mat-label>Database</mat-label>
      <mat-select [(ngModel)]="currentEndpoint" [placeholder]="dbPlaceholder"
        (selectionChange)="setEndpoint($event.value)">
        @for (database of endpoints.databases; track database) {
        <mat-option [value]="database">
          {{database.endpoint}}
        </mat-option>
        }
      </mat-select>
    </mat-form-field>

    @if (currentEndpoint) {
    <mat-form-field>
      <mat-label>Schema</mat-label>
      <mat-select [(ngModel)]="currentSchema" placeholder="Schema" (selectionChange)="setSchema($event.value)">
        <mat-checkbox (change)="setShowInternal($event.checked)" [checked]="currentContext.showInternal">Show
          Internal</mat-checkbox>
        @for (schema of currentEndpoint.schemas | hideInternal:currentContext.showInternal; track schema) {
        <mat-option [value]="schema">
          {{schema.owner}}
        </mat-option>
        }
        <mat-option disabled></mat-option>
      </mat-select>
    </mat-form-field>
    }

    @if (currentSchema) {
    <mat-form-field>
      <mat-label>Object Type</mat-label>
      <mat-select [(ngModel)]="currentObjectType" placeholder="Object Type"
        (selectionChange)="setObjectType($event.value)">
        @for (objectType of currentSchema.objectTypes; track objectType) {
        <mat-option [value]="objectType">
          {{objectType.type}} ({{objectType.count}})
        </mat-option>
        }
      </mat-select>
    </mat-form-field>
    }

    @if (ddlLink) {
    <mat-form-field>
      <mat-label>Download</mat-label>
      <mat-select [(ngModel)]="selectedOption" (selectionChange)="download()">
        <mat-option [value]="ddlLink">Oracle DDL</mat-option>
        @for (option of downloadOptions; track option) {
        <mat-option [value]="option.url">
          {{ option.name }}
        </mat-option>
        }
      </mat-select>
    </mat-form-field>
    }


    @if (currentEndpoint) {
    <p class="endpoint-desc">{{currentEndpoint.description}} </p>
    }
  </div>
</div>

@if (currentObjectType) {
<mat-accordion>
  <mat-expansion-panel [expanded]="!currentContext.objectName">
    <mat-expansion-panel-header>
      <mat-panel-title>
        {{currentObjectType.type}} ({{currentObjectType.count}})
      </mat-panel-title>
      <mat-panel-description>
        {{ currentContext.objectName || 'Select Object' }}
      </mat-panel-description>
    </mat-expansion-panel-header>
    <app-db-object-list></app-db-object-list>
  </mat-expansion-panel>
</mat-accordion>
}