@use '@angular/material' as mat;
@use 'hljs-solarized-light' as solarized-hljs;
@use 'solarized-palette' as solarized;
@use 'hljs-atom-one-dark' as atom-hljs;

// Define Palettes manually since variables are unavailable
$indigo-palette: (
  50: #e8eaf6,
  100: #c5cae9,
  200: #9fa8da,
  300: #7986cb,
  400: #5c6bc0,
  500: #3f51b5,
  600: #3949ab,
  700: #303f9f,
  800: #283593,
  900: #1a237e,
  A100: #8c9eff,
  A200: #536dfe,
  A400: #3d5afe,
  A700: #304ffe,
  contrast: (50: rgba(black, 0.87),
    100: rgba(black, 0.87),
    200: rgba(black, 0.87),
    300: white,
    400: white,
    500: white,
    600: white,
    700: white,
    800: white,
    900: white,
    A100: rgba(black, 0.87),
    A200: white,
    A400: white,
    A700: white,
  )
);

$cyan-palette: (
  50: #e0f7fa,
  100: #b2ebf2,
  200: #80deea,
  300: #4dd0e1,
  400: #26c6da,
  500: #00bcd4,
  600: #00acc1,
  700: #0097a7,
  800: #00838f,
  900: #006064,
  A100: #84ffff,
  A200: #18ffff,
  A400: #00e5ff,
  A700: #00b8d4,
  contrast: (50: rgba(black, 0.87),
    100: rgba(black, 0.87),
    200: rgba(black, 0.87),
    300: rgba(black, 0.87),
    400: rgba(black, 0.87),
    500: white,
    600: white,
    700: white,
    800: white,
    900: white,
    A100: rgba(black, 0.87),
    A200: rgba(black, 0.87),
    A400: rgba(black, 0.87),
    A700: rgba(black, 0.87),
  )
);

// Define Theme using M2 API structure (v18+ compatibility)
$visulate-primary: mat.m2-define-palette(solarized.$solarized-primary-palette);
$visulate-accent: mat.m2-define-palette(solarized.$solarized-accent-palette);

$visulate-theme: mat.m2-define-light-theme((color: (primary: $visulate-primary,
        accent: $visulate-accent,
      ),
      typography: mat.m2-define-typography-config($font-family: '"Inter", "Roboto", "Helvetica Neue", sans-serif',
      ),
    ));

// Include Theme
@include mat.core();

// Define CSS Variables for Light Mode (Default)
:root {
  --app-bg-color: #fdf6e3; // Base3
  --app-text-color: #657b83; // Base00
  --app-toolbar-bg: #eee8d5; // Base2
  --app-toolbar-text: #657b83; // Base00
  --app-sidebar-bg: #eee8d5; // Base2
  --app-card-bg: #fdf6e3; // Base3 (same as bg for consistent feel, or Base2 for contrast)
  --app-border-color: rgba(147, 161, 161, 0.2); // Base1
  --app-input-bg: #fdf6e3; // Base3
  --app-code-bg: #fdf6e3; // Base3

  --app-link-color: #268bd2; // Blue
  --app-heading-color: #586e75; // Base01
  --app-active-bg: #eee8d5; // Base2
  --app-active-text: #268bd2; // Blue
}

// Define Dark Theme with adjusted palettes for better contrast/standard adherence
// Material Dark Mode usually uses 200 level for primary and A200 for accent
$visulate-dark-primary: mat.m2-define-palette($indigo-palette, 200, 50, 400);
$visulate-dark-accent: mat.m2-define-palette($cyan-palette, A200, A100, A400);

$visulate-dark-theme: mat.m2-define-dark-theme((color: (primary: $visulate-dark-primary,
        accent: $visulate-dark-accent,
      ),
      typography: mat.m2-define-typography-config($font-family: '"Inter", "Roboto", "Helvetica Neue", sans-serif',
      ),
    ));

// Apply Dark Theme class
.dark-theme {
  @include mat.all-component-themes($visulate-dark-theme);

  // Standard Material Design Dark Theme Surface Colors
  --app-bg-color: #121212;
  --app-text-color: rgba(255, 255, 255, 0.87); // Standard high-emphasis text

  // Surfaces (Cards, Sidebar, Toolbar) - slightly lighter than bg
  --app-toolbar-bg: #1e1e1e;
  --app-toolbar-text: rgba(255, 255, 255, 0.87);
  --app-sidebar-bg: #1e1e1e;
  --app-card-bg: #1e1e1e;

  --app-border-color: rgba(255, 255, 255, 0.12);
  --app-input-bg: #2c2c2c; // Slightly distinct input bg
  --app-code-bg: #121212;

  --app-link-color: #9fa8da; // Indigo 200 (Matching primary dark var)
  --app-heading-color: rgba(255, 255, 255, 0.87);
  --app-active-bg: rgba(159, 168, 218, 0.15); // Indigo 200 with low opacity
  --app-active-text: #9fa8da; // Indigo 200

  // Override highlight.js for dark mode
  @include atom-hljs.styles();
}

// Apply Default Light Theme to body (if not dark)
body {
  @include mat.all-component-themes($visulate-theme);

  // Highlight.js Solarized Light
  @include solarized-hljs.styles();

  // Solarized Light Specific Overrides (where default theme remains white)
  .mat-drawer,
  .mat-sidenav {
    background-color: var(--app-sidebar-bg) !important;
  }

  .mat-card,
  .mat-mdc-card,
  .mat-expansion-panel,
  .mat-table,
  .mat-mdc-table {
    background-color: var(--app-card-bg) !important;
    color: var(--app-text-color) !important;
  }

  // Ensure expansion panel header matches sidebar/background
  .mat-expansion-panel-header {
    background-color: var(--app-sidebar-bg) !important;
  }

  // Override step selection container background if needed
  .step-selection-container {
    background-color: var(--app-bg-color);
  }

  // Override MDC text field background (dropdowns/inputs)
  .mdc-text-field--filled:not(.mdc-text-field--disabled) {
    background-color: var(--app-input-bg) !important;
  }

  // Override Dropdown Panel Background (the opened list)
  .mat-mdc-select-panel {
    background-color: var(--app-card-bg) !important;
  }

  .mat-mdc-option {
    color: var(--app-text-color) !important;

    &:hover:not(.mdc-list-item--disabled),
    &.mdc-list-item--selected:not(.mdc-list-item--disabled) {
      background-color: var(--app-active-bg) !important;
    }
  }
}

// Global Styles
html,
body,
.mat-drawer-inner-container {
  scrollbar-color: var(--app-border-color) var(--app-sidebar-bg); // Firefox support
}

/* Scrollbar Styling */
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

::-webkit-scrollbar-track {
  background: var(--app-sidebar-bg);
}

::-webkit-scrollbar-thumb {
  background: var(--app-border-color);
  border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--app-text-color);
}

html,
body {
  height: 100%;
}

body {
  margin: 0;
  font-family: "Inter", "Roboto", "Helvetica Neue", sans-serif;
  background-color: var(--app-bg-color);
  color: var(--app-text-color);
}

// Link styling
a {
  color: var(--app-link-color);
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

// Global visual improvements
.mat-card {
  background-color: var(--app-card-bg) !important;
  color: var(--app-text-color) !important;
  border-radius: 12px !important;
  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1) !important;
}

// Ensure buttons look good in dark mode
.dark-theme .mat-stroked-button {
  border-color: rgba(255, 255, 255, 0.2) !important;
}

.mat-stroked-button,
.mat-flat-button,
.mat-raised-button {
  border-radius: 20px !important;
  /* Pill shape */
}

/* Sidenav container */
.app-sidenav-container {
  background-color: transparent !important;
}